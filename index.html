<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ü—Ä–æ–µ–∫—Ç</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #e0f7fa;
      font-family: Arial, sans-serif;
    }
    #scene-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    /* –°—Ç–∏–ª—å –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è */
    #info {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      max-width: 80%;
      text-align: center;
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
    }

    #info.visible {
      opacity: 1;
      pointer-events: auto;
    }

    /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ / –æ—à–∏–±–∫–∞ */
    #status {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div id="scene-container"></div>
  <div id="info">–≠—Ç–æ –∫—Ä–∞—Å–∏–≤–æ–µ –¥–µ—Ä–µ–≤–æ. –ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –Ω–µ–º—É –µ—â—ë —Ä–∞–∑, —á—Ç–æ–±—ã —Å–∫—Ä—ã—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ.</div>
  <div id="status">–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏...</div>

  <!-- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ CDN (—É–±—Ä–∞–Ω—ã –ø—Ä–æ–±–µ–ª—ã –≤ URL!) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>

  <script>
    let scene, camera, renderer, controls, treeModel = null;
    const infoBox = document.getElementById('info');
    const statusEl = document.getElementById('status');

    function init() {
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0xcccccc);

      camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 100);
      camera.position.set(0, 2, 6);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(window.devicePixelRatio);
      document.getElementById('scene-container').appendChild(renderer.domElement);

      // –û—Å–≤–µ—â–µ–Ω–∏–µ
      const ambient = new THREE.AmbientLight(0xffffff, 0.6);
      scene.add(ambient);
      const sun = new THREE.DirectionalLight(0xffffff, 1);
      sun.position.set(5, 10, 5);
      scene.add(sun);

      // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Äî –û–ì–†–ê–ù–ò–ß–ï–ù–ù–û–ï –í–†–ê–©–ï–ù–ò–ï
      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.05;

      // üîí –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –≤—Ä–∞—â–µ–Ω–∏–µ –¢–û–õ–¨–ö–û –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ (–≤–æ–∫—Ä—É–≥ Y)
      controls.minPolarAngle = Math.PI / 2; // 90¬∞ ‚Äî —Å—Ç—Ä–æ–≥–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ
      controls.maxPolarAngle = Math.PI / 2;
      // (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –º–æ–∂–Ω–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –ª—ë–≥–∫–∏–π –Ω–∞–∫–ª–æ–Ω:
      // controls.minPolarAngle = Math.PI / 3;   // 60¬∞ ‚Äî –º–æ–∂–Ω–æ —á—É—Ç—å –≤–≤–µ—Ä—Ö
      // controls.maxPolarAngle = 2 * Math.PI / 3; // 120¬∞ ‚Äî –º–æ–∂–Ω–æ —á—É—Ç—å –≤–Ω–∏–∑

      // –ó–∞–ø—Ä–µ—Ç–∏—Ç—å –∑—É–º –∏ –ø–∞–Ω –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏:
      // controls.enableZoom = false;
      // controls.enablePan = false;

      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–µ–ª–∏ (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ —Ö–æ—Ä–æ—à–æ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏)
      controls.target.set(0, 1, 0); // —á—É—Ç—å –≤—ã—à–µ –æ—Å–Ω–æ–≤–∞–Ω–∏—è ‚Äî –Ω–∞ —Å—Ç–≤–æ–ª

      // –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏
      const loader = new THREE.GLTFLoader();
      loader.load(
        'Tree1.glb',
        (gltf) => {
          // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
          const box = new THREE.Box3().setFromObject(gltf.scene);
          const size = box.getSize(new THREE.Vector3()).length();
          const scale = 3 / size;
          gltf.scene.scale.set(scale, scale, scale);

          const center = box.getCenter(new THREE.Vector3());
          gltf.scene.position.x = -center.x * scale;
          gltf.scene.position.y = -box.min.y * scale; // —Å—Ç–∞–≤–∏–º –Ω–∞ "–∑–µ–º–ª—é"
          gltf.scene.position.z = -center.z * scale;

          scene.add(gltf.scene);
          treeModel = gltf.scene;

          statusEl.textContent = "–ì–æ—Ç–æ–≤–æ. –ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –¥–µ—Ä–µ–≤—É.";
          statusEl.style.background = 'rgba(0,100,0,0.7)';
          setTimeout(() => statusEl.style.opacity = '0', 2000);
        },
        undefined,
        (error) => {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Tree1.glb:', error);
          statusEl.textContent = '‚ùå –û—à–∏–±–∫–∞: Tree1.glb –Ω–µ –Ω–∞–π–¥–µ–Ω!';
          statusEl.style.background = 'rgba(200,0,0,0.8)';
        }
      );

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
      renderer.domElement.addEventListener('click', onSceneClick);

      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });
    }

    function onSceneClick(event) {
      // –ó–∞—â–∏—Ç–∞: –µ—Å–ª–∏ –º–æ–¥–µ–ª—å –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      if (!treeModel) return;

      const mouse = new THREE.Vector2();
      mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

      const raycaster = new THREE.Raycaster();
      raycaster.setFromCamera(mouse, camera);

      const intersects = raycaster.intersectObject(treeModel, true);

      if (intersects.length > 0) {
        infoBox.classList.toggle('visible');
      } else {
        infoBox.classList.remove('visible');
      }
    }

    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }

    init();
    animate();
  </script>
</body>
</html>